May 20 2014 - Teeple

- moved instrumentprofile parameters to the parameters file;
	DetectionThreshold		:= 0.2
	#LocalMaxFilterWidth = 2.5*referenceLineWidth
	LocalMaxFilterWidth		:= 3.25
	#MinPeakDepth			:= 1.5*noise
	MinPeakDepth			:= 1.5
  so that other instruments such as graces may have separate parameters. The graces
  parameters were causing espadons calibration to fail, finding no lines for the profile.
  
- fixed extraction bug that caused a divide by zero exception:

	double ycenter_plus, ycenter_minus;
	if((-beta + sqrt(beta*beta - 4*alpha*cc)) != 0 && (beta*beta - 4*alpha*cc) >= 0) {
		ycenter_plus = (2*alpha)/(-beta + sqrt(beta*beta - 4*alpha*cc));
		ycenter_minus = (2*alpha)/(-beta - sqrt(beta*beta - 4*alpha*cc));
	} else {
		//throw operaException("operaSpectralOrder:",operaErrorDivideByZeroError, __FILE__, __FUNCTION__, __LINE__);
		// DT May 20 2014 -- We are likely to run in to problems when indexing through MAXSPECTRALELEMENTSPERORDER
		// so, just break rather than throwing an exception and thus aborting...
		break;
	}

- fixed aperture extraction to not count orders with zero flux (this was re-entered into the code May 20)
	// DT May 14/20 2014, if we have no beam flux, we have no aperture...
	if (beamFluxFraction[k] > 0) {
		spectralOrder->setExtractionApertures(k,aperture[k]);
		spectralOrder->sethasExtractionApertures(true);           
	} else {
		spectralOrder->sethasExtractionApertures(false);           
	}
- LocalMaxFilterWidth	changed from 3.25 to 6.25

- bugs fixed:

operaTelluricWavelengthCorrection.h:56: warning: 'void printUsageSyntax(char*)' declared `static' but never defined

Status: closed-fixed
Group: Deferred to V2.0
Created: Tue May 20, 2014 08:23 PM UTC by Nadine Manset
Last Updated: Tue May 20, 2014 08:23 PM UTC
Owner: Eder Martioli

Installing as user manset on akua, version
opera-1.0.1207 build date Tue May 20 09:59:26 HST 2014

Actually 2 warnings there:
operaTelluricCorrection.cpp:210:7: warning: no newline at end of file
../../include/core-espadons/operaTelluricWavelengthCorrection.h:56: warning: 'void printUsageSyntax(char*)' declared `static' but never defined

operaStarPlusSky.cpp:322: warning: unused variable 'numberOfprintouts'

Status: closed-fixed
Group: Deferred to V2.0
Created: Tue May 20, 2014 08:21 PM UTC by Nadine Manset
Last Updated: Tue May 20, 2014 08:21 PM UTC
Owner: Eder Martioli

Installing as user manset on skua, version
opera-1.0.1207 build date Tue May 20 09:59:26 HST 2014

Warning (might not be harmful):
operaStarPlusSky.cpp: In function `int main(int, char**)':
operaStarPlusSky.cpp:322: warning: unused variable 'numberOfprintouts'

Eder,
Quite often your source files don't have a newline at the end. Could you make sure you pick up the files I fixed after the integration, so the problem doesn't come back. It is not a serious problem, but e want to get rid of all compiler warnings. Some can be serious...
Doug

[bugs:#114] operaSpectrograph.cpp:827:2: warning: no newline at end of file

operaSpectrograph.cpp:827:2: warning: no newline at end of file

Status: closed-fixed
Group: Deferred to V2.0
Created: Tue May 20, 2014 08:16 PM UTC by Nadine Manset
Last Updated: Tue May 20, 2014 08:16 PM UTC
Owner: Eder Martioli

Installing on akua as user manset, version
opera-1.0.1207 build date Tue May 20 09:59:26 HST 2014

There is a warning (might not be harmful):

2 warnings, one is warning: converting of negative value -0x0000003e7&#39; tounsigned int'

Status: closed-fixed
Group: Deferred to V2.0
Created: Tue May 20, 2014 08:24 PM UTC by Nadine Manset
Last Updated: Tue May 20, 2014 08:24 PM UTC
Owner: Eder Martioli

Installing as user manset on akua, version
opera-1.0.1207 build date Tue May 20 09:59:26 HST 2014

Those warnings look more harmful:

operaStitchOrders.cpp: In function int main(int, char**)': operaStitchOrders.cpp:317: warning: converting of negative value-0x0000003e7' to unsigned int' operaStitchOrders.cpp:349: warning: comparison between signed and unsigned integer expressions operaStitchOrders.cpp: In functionbool calculateWavelengthShiftByXCorrInRange(operaSpectralElements, operaSpectralElements, double, double, double, double, float, double, double&, double&)':
operaStitchOrders.cpp:449: warning: converting to unsigned int' fromdouble'

Installation fails on akua - operaQueryImageInfo.cpp:379: error: `notfits' was not declared in this scope

Status: closed-fixed
Group: Deferred to V2.0
Created: Thu May 15, 2014 02:34 AM UTC by Nadine Manset
Last Updated: Mon May 19, 2014 06:33 PM UTC
Owner: Eder Martioli

Installing opera-1.0.1195 build date Wed May 14 16:06:50 HST 2014
on akua.

Error message:
operaQueryImageInfo.cpp: In function int main(int, char**)': operaQueryImageInfo.cpp:379: error:notfits' was not declared in this scope

(I removed the variable as it was not used - DT)

- segfault fix in operaMasterFluecalibration - attempy to spline fit 1 one element array.
	#define MINELEMENTS 20
	// DT May 20 2014 you can't do spline fitting without some reasonable number of elements... if(nElements==0) {
	if(nElements < MINELEMENTS) {

- removed deprecated call to masterflatfieldcalibrations in espadons/Makefile.core

- fixed segfault in operaTelluricWavelengthCorrection.cpp
		// DT May 20 2014 fixed segfault in case that i goes less than zero...
        for(unsigned i=binsize-2; i>(unsigned)((float)binsize*(1.0 - continuumBinFraction)) && i >= 0; i--) {
            if (residuals_tmp[sindex[i]] < nsigcut*abdevm) {
                dytop = residuals_tmp[sindex[i]];
                break;
            }
        }
	line 470:
	// DT May 20 2014 don't try to process order if there are not enough spectral elements
	if (spectralOrder->getSpectralElements()->getnSpectralElements() < MINELEMENTS)
		continue;



